{% extends "system/base.html" %}
{% block title %}Drive {{ drive.id }}{% endblock %}

{% block content %}
    <div class="container-fluid">
        <!-- Page header and action buttons -->
        <div class="row mb-4">
            <div class="col">
                <h2>Drive {{ drive.id }}</h2>
                <a href="{{ url_for('game_detail', game_id=drive.game_id) }}" class="btn btn-secondary">Back to
                    Drives</a>
                <a href="{{ url_for('add_play', drive_id=drive.id) }}" class="btn btn-primary">Add Play</a>
                <a href="{{ url_for('export_drive', drive_id=drive.id) }}" class="btn btn-info">Export CSV</a>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <!-- Search input fixed above the table -->
                <div class="d-flex justify-content-end mb-3">
                    <input type="text" id="customSearch" class="form-control custom-search"
                           placeholder="Search plays...">
                </div>

                <!-- Scrollable table container -->
                <div class="table-responsive">
                    <table id="playTable" class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>Play #</th>
                            <th>ODK</th>
                            <th>Down</th>
                            <th>Distance</th>
                            <th>Yard Line</th>
                            <th>Play Type</th>
                            <th>Result</th>
                            <th>Gain/Loss</th>
                            <th>Personnel</th>
                            <th>Formation</th>
                            <th>Strength</th>
                            <th>Adjustment</th>
                            <th>Motion</th>
                            <th>Protection</th>
                            <th>Play Call</th>
                            <th>Direction</th>
                            <th>Tag</th>
                            <th>Hash</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for play in drive.plays %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ play.odk }}</td>
                                <td>{{ play.down }}</td>
                                <td>{{ play.distance }}</td>
                                <td>{{ play.yard_line }}</td>
                                <td>{{ play.play_type }}</td>
                                <td>{{ play.result }}</td>
                                <td>{{ play.gain_loss }}</td>
                                <td>{{ play.personnel }}</td>
                                <td>{{ play.off_form }}</td>
                                <td>{{ play.form_str }}</td>
                                <td>{{ play.form_adj }}</td>
                                <td>{{ play.motion }}</td>
                                <td>{{ play.protection }}</td>
                                <td>{{ play.off_play }}</td>
                                <td>{{ play.dir_call }}</td>
                                <td>{{ play.tag }}</td>
                                <td>{{ play.hash }}</td>
                                <td>
                                    <div class="d-flex align-items-center gap-1">
                                        <a href="{{ url_for('edit_play', play_id=play.id) }}"
                                           class="btn btn-sm btn-outline-primary" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <form action="{{ url_for('delete_play', play_id=play.id) }}" method="POST"
                                              onsubmit="return confirm('Delete this play?');" class="m-0 p-0">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <style>
        .table-responsive {
            overflow-x: auto;
        }

        .table th, .table td {
            white-space: nowrap;
            padding: 0.5rem;
        }

        /* sticky last column -> actions not moving */
        .table td:last-child,
        .table th:last-child {
            position: sticky;
            right: 0;
            background: white;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        /* hoover effect on rows */
        .table-hover tbody tr:hover {
            background-color: #f8f9fa;
        }

        /* style btns inside action column */
        .d-flex.gap-1 .btn {
            border-radius: 0;
        }

        .d-flex.gap-1 .btn:first-child {
            border-top-left-radius: 0.375rem;
            border-bottom-left-radius: 0.375rem;
        }

        .d-flex.gap-1 .btn:last-child {
            border-top-right-radius: 0.375rem;
            border-bottom-right-radius: 0.375rem;
        }

        .d-flex.gap-1 form {
            margin: 0;
            padding: 0;
        }

        .d-flex.gap-1 .btn i {
            pointer-events: none;
        }

        /* custom search input */
        .custom-search {
            max-width: 300px;
            background-color: transparent;
            border: 1px solid #ccc;
            transition: border-color 0.3s ease;
        }

        .custom-search:focus {
            outline: none;
            box-shadow: none;
            border-color: #999;
            background-color: transparent;
        }


        table.dataTable thead .sorting {
            background-image: none !important;
        }

        table.dataTable thead .sorting_asc,
        table.dataTable thead .sorting_desc {
            background-image: initial !important;
        }
    </style>

    {% block scripts %}
        <script>
            $(document).ready(function () {
                // init DTable with no paging, no info, fixed header, disable sorting on last column
                const table = $('#playTable').DataTable({
                    paging: false,
                    info: false,
                    fixedHeader: true,
                    dom: 't',  // disable built-in search ui
                    columnDefs: [
                        {orderable: false, targets: -1} // disable sorting on Actions column
                    ]
                });

                // link custom search input to DataTable search
                $('#customSearch').on('keyup', function () {
                    table.search(this.value).draw();
                });
            });
        </script>
    {% endblock scripts %}

{% endblock content %}
