{# templates/drive/drive_play_chart.html #}
{% extends "system/base.html" %}
{% block title %}Play Chart – {{ game.name }} (Drive {{ drive.id }}){% endblock %}

{% block head %}
{{ super() }}
<style>
    .drive-chart {
        position: relative;
        width: 100%;
        margin: 40px 0 20px 0 !important;
        background: #f5f5f5;
        border: 1px solid #ccc;
        padding-bottom: 60px;
    }

    .field-container {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }

    .yard-line {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #fff !important;
        opacity: 0.7;
    }

    .yard-line-number {
        position: absolute;
        bottom: -20px;
        font-size: 14px;
        color: #fff;
        text-shadow: 1px 1px 2px #000;
        text-align: center;
    }

    .drive-line {
        position: absolute;
        height: 50px;
        width: 100%;
    }

    .drive-bar {
        position: absolute;
        height: 100%;
        border: 2px solid #000 !important;
        box-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5) !important;
        z-index: 1;
    }

    .drive-bar.loss {
        background-color: #ff0000 !important;
    }

    .drive-bar.gain {
        background-color: #007bff !important;
    }

    .drive-bar.touchdown {
        background-color: #28a745 !important;
    }

    .drive-bar.punt {
        background-color: #ffc107 !important;
    }

    .drive-bar.field-goal {
        background-color: #17a2b8 !important;
    }

    .drive-label {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
        color: #fff;
        text-shadow: 1px 1px 2px #000;
        white-space: nowrap;
        text-align: center;
        z-index: 2;
    }

    .team-name-left {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 8.5%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.9em;
        z-index: 10;
        writing-mode: vertical-rl;
        transform: rotate(180deg);
        text-transform: uppercase;
    }

    .team-name-right {
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 8.25%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.9em;
        z-index: 10;
        writing-mode: vertical-rl;
        transform: rotate(180deg);
        text-transform: uppercase;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">
        {{ game.name }} – Play Chart (Drive {{ drive.id }})
    </h1>
    <p>Hometeam plays from Left to Right!</p>
    {% if plays|length == 0 %}
        <div class="alert alert-info">There are no Plays for this drive.</div>
    {% endif %}

    <div class="drive-chart" style="height: {{ plays|length * 60 + 100 }}px;">
        <div class="field-container"
             style="background: linear-gradient(to right,
                 {{ home }} 0%,{{ home }} 8.5%,
                 #2e7d32 8.5%,#2e7d32 91.75%,
                 {{ away }} 91.75%,{{ away }} 100%) !important;">

            <!-- Left Side: Home Team Text -->
            <div class="team-name-left" style="color: {{ home_text }};">
                {{ game.home_team.name if game.home_team else 'HOME' }}
            </div>

            <!-- Right Side: Away Team Text -->
            <div class="team-name-right" style="color: {{ away_text }};">
                {{ game.away_team.name if game.away_team else 'OPPONENT' }}
            </div>

            <!-- Yard-lines all 5 yards -->
            {% for i in range(1, 20) %}
                {% set yard = i * 5 %}
                <div class="yard-line" style="left: {{ (yard / 1.2) + 8.33 }}%;"></div>
                <div class="yard-line-number" style="left: {{ (yard / 1.2) + 8.33 - 0.5 }}%;">
                    {% if i == 10 %}
                        50
                    {% elif i < 10 %}
                        {{ -yard }}
                    {% else %}
                        {{ 100 - yard }}
                    {% endif %}
                </div>
            {% endfor %}

            <!-- Plays -->
            {% for play in plays %}
                <div class="drive-line" style="top: {{ 40 + loop.index0 * 60 }}px;">
                    <!-- Play-bar -->
                    <div class="drive-bar 
                    {{ 'loss' if play.loss else 'gain' }} 
                    {{ play.result|lower|replace(' ', '-') }}"
                         style="
                            left: {{ ((play.start / 100) * 100) / 1.2 + 8.33 }}%;
                            {% if play.result|lower == 'touchdown' %}
                                width: {{ 92 - (((play.start / 100) * 100) / 1.2 + 8.33) }}%;
                            {% else %}
                                width: {{ (((play.end - play.start) / 100) * 100) / 1.2 }}%;
                            {% endif %}
                         ">
                    </div>
                    <!-- Play label centered -->
                    <div class="drive-label"
                         style="
                            left: {{ ((play.start / 100) * 100) / 1.2 + 8.33 }}%;
                            {% if play.result|lower == 'touchdown' %}
                                width: {{ 92 - (((play.start / 100) * 100) / 1.2 + 8.33) }}%;
                            {% else %}
                                width: {{ (((play.end - play.start) / 100) * 100) / 1.2 }}%;
                            {% endif %}
                         ">
                        {{ play.play_type or play.result or 'Unknown' }}
                        {% if play.result|lower == 'penalty' %}
                            {% if play.foul_team == "H" %}
                                Home
                            {% else %}
                                Opponent
                            {% endif %}
                        {% endif %}
                        ({{ play.yards }} yds)
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}