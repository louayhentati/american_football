<script>
    ///stable version?!
const steps = [
    "step-shape",
    "step-pattern",
    "step-color",
    "step-adjust",
    "step-icon",
    "step-adjust-icon",
    "step-name"
];

let iconX = 120;
let iconY = 120;

let currentStep = 0;

const btnNext = document.getElementById("btn-next");
const btnBack = document.getElementById("btn-back");

const shapeThumbs = document.querySelectorAll(".shape-thumb");
const patternThumbs = document.querySelectorAll(".pattern-thumb");
const clipPathShape = document.getElementById("clip-path-shape");
const shieldOutline = document.getElementById("shield-outline");
const patternFill = document.getElementById("pattern-fill");
const livePreview = document.getElementById("live-preview");
const shieldIcon = document.getElementById("shield-icon");
const iconUploadInput = document.getElementById("icon-upload");
const resetBtn = document.getElementById("reset-icon-choice");
let iconChosen = false;

let selectedShape = null;
let selectedPattern = null;
let selectedIcon = null;
let primaryColor = "#d32f2f";
let secondaryColor = "#fdd835";


const primaryPicker = new iro.ColorPicker("#primary-picker", { width: 150, color: primaryColor });
const secondaryPicker = new iro.ColorPicker("#secondary-picker", { width: 150, color: secondaryColor });
let patternOffsetX = 0;
let patternOffsetY = 0;
let patternScale = 60; 
const iconZoomSlider = document.getElementById("icon-zoom-range");
const iconZoomInput = document.getElementById("icon-zoom-value");

const iconPad = document.getElementById("icon-move-pad");
const iconIndicator = document.getElementById("icon-pad-indicator");

let isIconDragging = false;
let iconOriginX, iconOriginY;


function movePattern(dx, dy) {
    patternOffsetX += dx;
    patternOffsetY += dy;

    updatePatternTransform();
}

function zoomPattern(delta) {
    patternScale = Math.max(10, patternScale + delta); // prevent zero or negative scale
    updatePatternTransform();
}

function updatePatternTransform() {
    const patternFill = document.getElementById("pattern-fill");
    const patternUrl = patternFill.getAttribute("fill");
    if (!patternUrl) return;

    const patternId = patternUrl.replace("url(#", "").replace(")", "");
    const patternElement = document.getElementById(patternId);
    if (!patternElement) return;

    // Set patternUnits to userSpaceOnUse (already done in your HTML)
    patternElement.setAttribute("patternTransform", `translate(${patternOffsetX}, ${patternOffsetY}) scale(${patternScale / 60})`);

    // Also update the <image> inside the pattern if it exists
    const image = patternElement.querySelector("image");
    if (image) {
        image.setAttribute("width", 60);  // stay at base size
        image.setAttribute("height", 60);
    }
}



function moveIcon(dx, dy) {
    iconX += dx;
    iconY += dy;

    const img = document.getElementById("shield-icon");
    const svg = document.getElementById("inline-shield-icon");

    if (img && img.getAttribute("visibility") === "visible") {
        img.setAttribute("x", iconX);
        img.setAttribute("y", iconY);
    } else if (svg) {
        svg.setAttribute("x", iconX);
        svg.setAttribute("y", iconY);
    }
}



primaryPicker.on(["color:change", "input:change"], color => {
  primaryColor = color.hexString; // This includes the "#" prefix
  document.getElementById("primary-hex").value = primaryColor; // Set full hex string including #
  updatePatternColors();
});

secondaryPicker.on(["color:change", "input:change"], color => {
  secondaryColor = color.hexString;
  document.getElementById("secondary-hex").value = secondaryColor; // Set full hex string including #
  updatePatternColors();
});


shapeThumbs.forEach(thumb => {
    thumb.addEventListener("click", () => {
        shapeThumbs.forEach(t => t.style.border = "3px solid transparent");
        thumb.style.border = "3px solid #007bff";
        selectedShape = thumb.dataset.shape;
        fetchShapePath(selectedShape);
        btnNext.disabled = false;
    });
});

patternThumbs.forEach(thumb => {
    thumb.addEventListener("click", () => {
        patternThumbs.forEach(t => t.style.border = "2px solid transparent");
        thumb.style.border = "2px solid #007bff";
        selectedPattern = thumb.dataset.pattern;
        patternFill.setAttribute("fill", `url(#${selectedPattern})`);
        updatePatternColors();
        btnNext.disabled = false;
    });
});

btnNext.addEventListener("click", () => {
    if (currentStep < steps.length - 1) {

        // FIX: Do not block transition even if iconChosen is false
        document.getElementById(steps[currentStep]).style.display = "none";
        currentStep++;
        document.getElementById(steps[currentStep]).style.display = "block";

        btnBack.style.display = currentStep === 0 ? "none" : "inline-block";

        // Only disable Next if shape or pattern is missing on relevant steps
        if (steps[currentStep] === "step-shape" && !selectedShape) {
            btnNext.disabled = true;
        } else if (steps[currentStep] === "step-pattern" && !selectedPattern) {
            btnNext.disabled = true;
        } else {
            btnNext.disabled = false;
        }

        // Refresh icon list if needed
        if (steps[currentStep] === "step-icon") loadIcons();
    }
});




btnBack.addEventListener("click", () => {
    document.getElementById(steps[currentStep]).style.display = "none";
    currentStep--;
    document.getElementById(steps[currentStep]).style.display = "block";
    btnNext.style.display = "inline-block";
    btnBack.style.display = currentStep === 0 ? "none" : "inline-block";
    btnNext.disabled = (steps[currentStep] === "step-shape" && !selectedShape) ||
                       (steps[currentStep] === "step-pattern" && !selectedPattern);
});

function fetchShapePath(filename) {
    fetch(`/static/team_creation_assets/base/${filename}`)
        .then(res => res.text())
        .then(svgText => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(svgText, "image/svg+xml");
            const path = doc.querySelector("path");
            if (!path) return;
            const d = path.getAttribute("d");
            const tempSVG = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            const tempPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
            tempPath.setAttribute("d", d);
            tempSVG.appendChild(tempPath);
            document.body.appendChild(tempSVG);
            const bbox = tempPath.getBBox();
            document.body.removeChild(tempSVG);

            livePreview.setAttribute("viewBox", `${bbox.x} ${bbox.y} ${bbox.width} ${bbox.height}`);
            clipPathShape.setAttribute("d", d);
            shieldOutline.setAttribute("d", d);
            if (selectedPattern) patternFill.setAttribute("fill", `url(#${selectedPattern})`);
        });
}

function updatePatternColors() {
    for (let i = 1; i <= 6; i++) {
        const pattern = document.getElementById(`pattern${i}`);
        const thumbPattern = document.getElementById(`thumb-pattern${i}`);
        if (!pattern || !thumbPattern) continue;

        let svgContent = "";
        switch (i) {
            case 1:
                // Vertical split
                svgContent = `
                    <rect width="30" height="60" fill="${secondaryColor}"/>
                    <rect x="30" width="30" height="60" fill="${primaryColor}"/>
                `;
                break;
            case 2:
                // X-shaped diagonal cross
                svgContent = `
                    <rect width="60" height="60" fill="${primaryColor}"/>
                    <line x1="0" y1="0" x2="60" y2="60" stroke="${secondaryColor}" stroke-width="10"/>
                    <line x1="0" y1="60" x2="60" y2="0" stroke="${secondaryColor}" stroke-width="10"/>
                `;
                break;
            case 3:
                // Triple diagonal lines
                svgContent = `
                    <rect width="60" height="60" fill="${primaryColor}"/>
                    <line x1="0" y1="0" x2="60" y2="60" stroke="${secondaryColor}" stroke-width="10"/>
                    <line x1="-30" y1="0" x2="30" y2="60" stroke="${secondaryColor}" stroke-width="10"/>
                    <line x1="30" y1="0" x2="90" y2="60" stroke="${secondaryColor}" stroke-width="10"/>
                `;
                break;
            case 4:
                // Horizontal stripe in the center
                svgContent = `
                    <rect width="60" height="60" fill="${secondaryColor}"/>
                    <rect y="20" width="60" height="20" fill="${primaryColor}"/>
                `;
                break;
            case 5:
                // Dots
                svgContent = `
                    <rect width="60" height="60" fill="${primaryColor}"/>
                    <circle cx="30" cy="30" r="20" fill="${secondaryColor}"/>
                `;
                break;
            case 6:
                // Two small boxes
                svgContent = `
                    <rect width="60" height="60" fill="${primaryColor}"/>
                    <rect x="0" y="0" width="30" height="30" fill="${secondaryColor}"/>
                    <rect x="30" y="30" width="30" height="30" fill="${secondaryColor}"/>
                `;
                break;
        }

        pattern.innerHTML = svgContent;
        thumbPattern.innerHTML = svgContent;
    }

    if (selectedPattern) patternFill.setAttribute("fill", `url(#${selectedPattern})`);
}


function hexToLuminance(hex) {
    const rgb = hex.replace("#", "").match(/.{2}/g).map(h => parseInt(h, 16) / 255);
    const [r, g, b] = rgb.map(c => c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4));
    return 0.2126 * r + 0.7152 * g + 0.0722 * b;
}



function disableIconUpload() {
    iconUploadInput.disabled = true;
}

function disableIconCatalog() {
    document.querySelectorAll(".icon-thumb").forEach(img => {
        img.style.pointerEvents = "none";
        img.style.opacity = 0.3;
    });
}

function enableAllIconOptions() {
    iconUploadInput.disabled = false;
    iconUploadInput.value = "";

    document.querySelectorAll(".icon-thumb").forEach(img => {
        img.style.pointerEvents = "auto";
        img.style.opacity = 1;
        img.classList.remove("border-primary");
    });

    selectedIcon = null;
    shieldIcon.setAttribute("visibility", "hidden");
    shieldIcon.removeAttribute("href");

   
}

resetBtn.addEventListener("click", () => {
    // Enable all icon options
    enableAllIconOptions();
    iconChosen = false;
    btnNext.disabled = true;

    // Reset selected icon styling (remove border)
    document.querySelectorAll(".icon-thumb").forEach(img => {
        img.classList.remove("border-primary");
    });

    // Remove inline SVG icon if exists
    const oldInline = document.getElementById("inline-shield-icon");
    if (oldInline) oldInline.remove();

    // Reset shield-icon <image>
    shieldIcon.setAttribute("href", "");
    shieldIcon.setAttribute("visibility", "hidden");

    // Clear uploaded icon filename
    document.getElementById("form_icon_filename").value = "";

    // Reset icon position and zoom
    iconX = 120;
    iconY = 120;
    iconZoomSlider.value = 60;
    iconZoomInput.value = 60;

    // Reset pagination buttons
    iconPrev.disabled = currentIconPage === 0;
    iconNext.disabled = (currentIconPage + 1) * iconsPerPage >= iconList.length;
});




const iconContainer = document.getElementById("icon-container");
const iconPrev = document.getElementById("icon-prev");
const iconNext = document.getElementById("icon-next");

let iconList = {{ icon_filenames|tojson }};
let currentIconPage = 0;
const iconsPerPage = 6;


function loadIcons() {
    iconContainer.innerHTML = "";
    const start = currentIconPage * iconsPerPage;
    const pageIcons = iconList.slice(start, start + iconsPerPage);

    pageIcons.forEach(filename => {
        const col = document.createElement("div");
        col.className = "col-4 d-flex justify-content-center mb-3";
        col.innerHTML = `
            <div class="icon-wrapper">
                <img src="/static/team_creation_assets/icons/${filename}"
                    data-icon="${filename}"
                    class="icon-thumb" />
            </div>
            `;
        const img = col.querySelector("img");

        img.addEventListener("click", () => {
            disableIconUpload(); // disable upload once catalog icon is chosen

            document.querySelectorAll(".icon-thumb").forEach(img => img.classList.remove("border-primary"));
            img.classList.add("border-primary");

            selectedIcon = filename;
            iconChosen = true;
            btnNext.disabled = false;

            const vb = livePreview.viewBox.baseVal;
            const iconWidth = 400;
            const iconHeight = 400;
            const centerX = vb.x + vb.width / 2 - iconWidth / 2;
            const centerY = vb.y + vb.height / 2 - iconHeight / 2;

            const isSVG = filename.toLowerCase().endsWith(".svg");

            if (isSVG) {
                fetch(`/static/team_creation_assets/icons/${filename}`)
                    .then(res => res.text())
                    .then(svgText => {
                        const parser = new DOMParser();
                        const svgDoc = parser.parseFromString(svgText, "image/svg+xml");
                        const svgEl = svgDoc.querySelector("svg");

                        if (!svgEl) return;

                        const oldInline = document.getElementById("inline-shield-icon");
                        if (oldInline) oldInline.remove();

                        svgEl.setAttribute("id", "inline-shield-icon");
                        svgEl.setAttribute("width", iconWidth);
                        svgEl.setAttribute("height", iconHeight);
                        svgEl.setAttribute("x", centerX);
                        svgEl.setAttribute("y", centerY);
                        svgEl.setAttribute("preserveAspectRatio", "xMidYMid meet");

                        shieldIcon.setAttribute("visibility", "hidden");
                        shieldIcon.removeAttribute("href");

                        livePreview.appendChild(svgEl);
                    });
            } else {
                shieldIcon.setAttribute("href", `/static/team_creation_assets/icons/${filename}`);
                shieldIcon.setAttribute("visibility", "visible");
                shieldIcon.setAttribute("width", iconWidth);
                shieldIcon.setAttribute("height", iconHeight);
                shieldIcon.setAttribute("x", centerX);
                shieldIcon.setAttribute("y", centerY);

                const oldInline = document.getElementById("inline-shield-icon");
                if (oldInline) oldInline.remove();
            }

            document.getElementById("form_icon_filename").value = selectedIcon;
            document.getElementById("form_primary_color").value = primaryColor;
            document.getElementById("form_secondary_color").value = secondaryColor;
        });

        iconContainer.appendChild(col);
    });

    iconPrev.disabled = currentIconPage === 0;
    iconNext.disabled = start + iconsPerPage >= iconList.length;
}


iconNext.addEventListener("click", () => {
    if ((currentIconPage + 1) * iconsPerPage < iconList.length) {
        currentIconPage++;
        loadIcons();
    }
});

iconPrev.addEventListener("click", () => {
    if (currentIconPage > 0) {
        currentIconPage--;
        loadIcons();
    }
});

iconUploadInput.addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const validTypes = ["image/png", "image/svg+xml"];
    if (!validTypes.includes(file.type)) {
        alert("Only transparent PNG or SVG files are allowed.");
        iconUploadInput.value = "";
        return;
    }

    disableIconCatalog();

    // ✅ Disable pagination buttons
    iconPrev.disabled = true;
    iconNext.disabled = true;

    const reader = new FileReader();
    reader.onload = function (event) {
        const vb = livePreview.viewBox.baseVal;
        const iconWidth = 400;
        const iconHeight = 400;
        const centerX = vb.x + vb.width / 2 - iconWidth / 2;
        const centerY = vb.y + vb.height / 2 - iconHeight / 2;

        iconX = centerX;
        iconY = centerY;
        iconZoomSlider.value = iconWidth;
        iconZoomInput.value = iconWidth;

        const oldInline = document.getElementById("inline-shield-icon");
        if (oldInline) oldInline.remove();
        shieldIcon.setAttribute("visibility", "hidden");

        if (file.type === "image/svg+xml") {
            const parser = new DOMParser();
            const svgDoc = parser.parseFromString(event.target.result, "image/svg+xml");
            const innerSVG = svgDoc.querySelector("svg");

            if (!innerSVG) {
                alert("Invalid SVG format.");
                return;
            }

            const inline = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            inline.setAttribute("id", "inline-shield-icon");
            inline.setAttribute("width", iconWidth);
            inline.setAttribute("height", iconHeight);
            inline.setAttribute("x", centerX);
            inline.setAttribute("y", centerY);
            inline.setAttribute("viewBox", innerSVG.getAttribute("viewBox") || "0 0 100 100");

            for (const node of innerSVG.childNodes) {
                inline.appendChild(node.cloneNode(true));
            }

            livePreview.querySelector("#shield-group > g").appendChild(inline);
        } else {
            shieldIcon.setAttribute("href", event.target.result);
            shieldIcon.setAttribute("visibility", "visible");
            shieldIcon.setAttribute("width", iconWidth);
            shieldIcon.setAttribute("height", iconHeight);
            shieldIcon.setAttribute("x", centerX);
            shieldIcon.setAttribute("y", centerY);
        }

        updateIconContrastColor();

        document.getElementById("form_icon_filename").value = file.name;
        document.getElementById("form_primary_color").value = primaryColor;
        document.getElementById("form_secondary_color").value = secondaryColor;
        document.getElementById("save-form").style.display = "block";
        document.getElementById("save-form").scrollIntoView({ behavior: "smooth" });

        iconChosen = true;
        btnNext.disabled = false;
    };

    reader.readAsDataURL(file);
});




document.getElementById("save-form").addEventListener("submit", function (e) {
    if (currentStep !== steps.length - 1) {
        e.preventDefault(); 
        return;
    }

    const teamName = document.getElementById("team-name").value.trim();
    const nameError = document.getElementById("name-error");

    if (teamName === "") {
        e.preventDefault();
        nameError.style.display = "block";
        document.getElementById("team-name").classList.add("is-invalid");
        return;
    } else {
        nameError.style.display = "none";
        document.getElementById("team-name").classList.remove("is-invalid");
    }

    const svg = document.getElementById("live-preview");
    const clone = svg.cloneNode(true);
    const vb = svg.getAttribute("viewBox");

    clone.querySelectorAll("rect").forEach(rect => {
        const fill = rect.getAttribute("fill");
        if (fill && (fill === "#fff" || fill === "#ffffff" || fill.toLowerCase() === "white")) {
            rect.remove();
        }
    });

    const iconFilename = document.getElementById("form_icon_filename").value;
    const iconImage = clone.querySelector("image");
    if (iconImage && iconFilename && (iconFilename.endsWith(".png") || iconFilename.endsWith(".svg"))) {
        const safeTeamName = teamName.replace(/[^\w.-]/g, "_"); // sanitize
        iconImage.setAttribute("href", `/static/user_created_icons/${safeTeamName}/${iconFilename}`);
    }

    const shapePath = document.getElementById("clip-path-shape").getAttribute("d");
    const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");

    const mask = document.createElementNS("http://www.w3.org/2000/svg", "mask");
    mask.setAttribute("id", "shield-mask");

    const maskRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
    maskRect.setAttribute("width", "100%");
    maskRect.setAttribute("height", "100%");
    maskRect.setAttribute("fill", "black");

    const maskShape = document.createElementNS("http://www.w3.org/2000/svg", "path");
    maskShape.setAttribute("d", shapePath);
    maskShape.setAttribute("fill", "white");

    mask.appendChild(maskRect);
    mask.appendChild(maskShape);
    defs.appendChild(mask);
    clone.insertBefore(defs, clone.firstChild);

    const contentGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
    contentGroup.setAttribute("mask", "url(#shield-mask)");

    const children = Array.from(clone.children).filter(child => child.tagName !== "defs");
    children.forEach(child => contentGroup.appendChild(child));
    clone.appendChild(contentGroup);

    clone.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    clone.setAttribute("viewBox", vb);

    document.getElementById("form_primary_color").value = primaryColor;
    document.getElementById("form_secondary_color").value = secondaryColor;
    document.getElementById("form_icon_filename").value =
        selectedIcon || iconUploadInput.files[0]?.name || "";

    const serializer = new XMLSerializer();
    const svgString = serializer.serializeToString(clone);
    document.getElementById("final_svg").value = svgString;
});


updatePatternColors();

// --- Pattern Move Pad ---
const pad = document.getElementById("pattern-move-pad");
const indicator = document.getElementById("pad-indicator");
let isDragging = false;
let originX, originY;

pad.addEventListener("mousedown", function (e) {
    isDragging = true;
    originX = e.offsetX;
    originY = e.offsetY;
    pad.style.cursor = "grabbing";
});

pad.addEventListener("mousemove", function (e) {
    if (!isDragging) return;

    const dx = e.offsetX - originX;
    const dy = e.offsetY - originY;
    originX = e.offsetX;
    originY = e.offsetY;

    movePattern(dx * 1.5, dy * 1.5);

    const newLeft = Math.max(0, Math.min(140, parseFloat(indicator.style.left) + dx));
    const newTop = Math.max(0, Math.min(140, parseFloat(indicator.style.top) + dy));
    indicator.style.left = `${newLeft}px`;
    indicator.style.top = `${newTop}px`;
});

pad.addEventListener("mouseup", () => {
    isDragging = false;
    pad.style.cursor = "grab";
});
pad.addEventListener("mouseleave", () => {
    isDragging = false;
    pad.style.cursor = "grab";
});

const zoomSlider = document.getElementById("zoom-range");
const zoomInput = document.getElementById("zoom-value");

zoomSlider.addEventListener("input", () => {
    patternScale = parseFloat(zoomSlider.value);
    zoomInput.value = patternScale;
    updatePatternTransform();
});

zoomInput.addEventListener("input", () => {
    patternScale = parseFloat(zoomInput.value);
    zoomSlider.value = patternScale;
    updatePatternTransform();
});

document.getElementById("live-preview").addEventListener("wheel", function (e) {
    if (steps[currentStep] !== "step-adjust") return;

    e.preventDefault();
    const delta = e.deltaY < 0 ? 2 : -2;
    patternScale = Math.max(10, Math.min(200, patternScale + delta));
    zoomSlider.value = patternScale;
    zoomInput.value = patternScale;
    updatePatternTransform();
});


function setIconSize(w, h) {
    const vb = livePreview.viewBox.baseVal;
    const x = vb.x + vb.width / 2 - w / 2;
    const y = vb.y + vb.height / 2 - h / 2;

    iconX = x;
    iconY = y;

    const img = document.getElementById("shield-icon");
    const svg = document.getElementById("inline-shield-icon");

    if (img && img.getAttribute("visibility") === "visible") {
        img.setAttribute("width", w);
        img.setAttribute("height", h);
        img.setAttribute("x", x);
        img.setAttribute("y", y);
    } else if (svg) {
        svg.setAttribute("width", w);
        svg.setAttribute("height", h);
        svg.setAttribute("x", x);
        svg.setAttribute("y", y);
    }
}

iconZoomSlider.addEventListener("input", () => {
  const w = parseInt(iconZoomSlider.value, 10);
  iconZoomInput.value = w;
  setIconSize(w, w);
});
iconZoomInput.addEventListener("input", () => {
  const w = parseInt(iconZoomInput.value, 10);
  iconZoomSlider.value = w;
  setIconSize(w, w);
});

livePreview.addEventListener("wheel", function(e) {
  if (steps[currentStep] !== "step-adjust-icon") return;

  const icon = shieldIcon;
  if (!icon || icon.getAttribute("visibility") === "hidden") return;

  e.preventDefault();
  const delta = e.deltaY < 0 ? 10 : -10;
  const cur   = parseInt(icon.getAttribute("width"), 10);
  const next  = Math.max(10, Math.min(600, cur + delta));
  setIconSize(next, next);
  iconZoomSlider.value = next;
  iconZoomInput.value  = next;
});

iconPad.addEventListener("mousedown", e => {
  isIconDragging = true;
  iconOriginX    = e.offsetX;
  iconOriginY    = e.offsetY;
  iconPad.style.cursor = "grabbing";
});
iconPad.addEventListener("mousemove", e => {
  if (!isIconDragging) return;
  const dx = e.offsetX - iconOriginX;
  const dy = e.offsetY - iconOriginY;
  iconOriginX = e.offsetX;
  iconOriginY = e.offsetY;

  moveIcon(dx*1.5, dy*1.5);

  let left = (parseFloat(iconIndicator.style.left)||70) + dx;
  let top  = (parseFloat(iconIndicator.style.top )||70) + dy;
  iconIndicator.style.left = `${Math.max(0, Math.min(140, left))}px`;
  iconIndicator.style.top  = `${Math.max(0, Math.min(140, top ))}px`;
});
iconPad.addEventListener("mouseup", () => {
  isIconDragging = false;
  iconPad.style.cursor = "grab";
});
iconPad.addEventListener("mouseleave", () => {
  isIconDragging = false;
  iconPad.style.cursor = "grab";
});

document.getElementById("primary-hex").value = primaryColor.toUpperCase();
document.getElementById("secondary-hex").value = secondaryColor.toUpperCase();


document.getElementById("primary-hex").addEventListener("input", function () {
    let val = this.value.trim().replace("#", "").toUpperCase();
    val = val.replace(/[^0-9A-F]/g, ""); // Remove invalid characters
    if (val.length > 6) val = val.slice(0, 6);
    this.value = "#" + val;
    if (val.length === 6) {
        primaryPicker.color.hexString = "#" + val;
    }
});

document.getElementById("secondary-hex").addEventListener("input", function () {
    let val = this.value.trim().replace("#", "").toUpperCase();
    val = val.replace(/[^0-9A-F]/g, ""); // Remove invalid characters
    if (val.length > 6) val = val.slice(0, 6);
    this.value = "#" + val;
    if (val.length === 6) {
        secondaryPicker.color.hexString = "#" + val;
    }
});



document.getElementById("secondary-hex").addEventListener("input", function () {
    const val = this.value.trim().replace("#", "");
    if (/^[0-9a-fA-F]{0,6}$/.test(val)) {
        this.value = "#" + val;
        if (val.length === 6) {
            secondaryPicker.color.hexString = "#" + val;
        }
    } else {
        this.value = secondaryColor;
    }
});

</script>
