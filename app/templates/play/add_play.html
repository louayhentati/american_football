{% extends "system/base.html" %}
{% block title %}{{ 'Edit Play' if play else 'Add Play' }}{% endblock %}
{% block content %}
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">{{ 'Edit Play' if play else 'Add Play' }}</div>
                <div class="card-body">
                    <form id="playForm"
                          data-mode="add"
                          data-endpoint-add="{{ url_for('add_play', drive_id=drive.id) }}"
                          data-redirect="{{ url_for('drive_detail', drive_id=drive.id) }}"
                          onsubmit="handleSubmit(event)">

                        <!-- ODK Selection -->
                        <div class="mb-3">
                            <label class="form-label">ODK</label>
                            <div class="btn-group" role="group">
                                <input type="radio" class="btn-check" name="odk" id="odk-o" value="O"
                                       {% if play and play.odk == 'O' %}checked{% elif not play %}checked{% endif %}>
                                <label class="btn btn-outline-primary" for="odk-o">Offense</label>

                                <input type="radio" class="btn-check" name="odk" id="odk-d" value="D"
                                       {% if play and play.odk == 'D' %}checked{% endif %}>
                                <label class="btn btn-outline-primary" for="odk-d">Defense</label>

                                <input type="radio" class="btn-check" name="odk" id="odk-k" value="K"
                                       {% if play and play.odk == 'K' %}checked{% endif %}>
                                <label class="btn btn-outline-primary" for="odk-k">Special Teams</label>
                            </div>
                        </div>

                        <!-- Down & Distance -->
                        <div class="row mb-3">
                            <div class="col">
                                <label class="form-label">Down</label><br>
                                <div class="btn-group" role="group">
                                    {% for down_number in range(1, 5) %}
                                        <input type="radio" class="btn-check" name="down" id="down-{{ down_number }}"
                                               value="{{ down_number }}"
                                                {% if play and play.down == down_number %}
                                               checked
                                                {% elif not play and down_number == default_down %}
                                               checked
                                                {% endif %}>
                                        <label class="btn btn-outline-primary"
                                               for="down-{{ down_number }}">{{ down_number }}</label>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="col">
                                <label for="distance" class="form-label">Distance (yards to go)</label>
                                <input type="number" name="distance" id="distance" class="form-control"
                                       min="1" max="10" step="1" required
                                       value="{{ play.distance if play else default_distance }}">
                            </div>
                        </div>

                        <!-- Hash -->
                        <div class="mb-3">
                            <label class="form-label">Hash</label><br>
                            <div class="btn-group">
                                {% for h in ['L', 'M', 'R'] %}
                                    <input type="radio" class="btn-check" name="hash" id="hash-{{ h }}" value="{{ h }}"
                                           {% if play and play.hash == h %}checked{% endif %}>
                                    <label class="btn btn-outline-primary" for="hash-{{ h }}">{{ h }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Yard Line -->
                        <div class="mb-3">
                            <label class="form-label">Yard Line</label>
                            <div class="input-group">
                                <input type="number" name="yard_line" id="yard_line" class="form-control"
                                       min="-49" max="49" step="1" required
                                       value="{{ default_yard_line }}">
                                <button type="button" class="btn btn-outline-secondary" onclick="toggleYardLine()"
                                        title="Switch between own/opponent territory">
                                    Own / Opp
                                </button>
                            </div>
                            <div class="form-text">
                                Negative = opponent territory, Positive = own territory
                            </div>
                        </div>


                        <!-- Personnel -->
                        <div class="mb-3">
                            <label class="form-label">Personnel</label><br>
                            <div class="btn-group">
                                {% for p in ['10', '11', '20', '21'] %}
                                    <input type="radio" class="btn-check" name="personnel" id="pers-{{ p }}"
                                           value="{{ p }}"
                                           {% if play and play.personnel == p %}checked{% endif %}>
                                    <label class="btn btn-outline-primary" for="pers-{{ p }}">{{ p }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Offensive Formation -->
                        <div class="mb-3">
                            <label class="form-label">Offensive Formation</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for option in options.off_form %}
                                    <input type="radio" class="btn-check" name="off_form" id="off_form-{{ option.id }}"
                                           value="{{ option.value }}"
                                           {% if play and play.off_form == option.value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="off_form-{{ option.id }}">{{ option.value }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Formation Strength -->
                        <div class="mb-3">
                            <label class="form-label">Formation Strength</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for option in options.form_str %}
                                    <input type="radio" class="btn-check" name="form_str" id="form_str-{{ option.id }}"
                                           value="{{ option.value }}"
                                           {% if play and play.form_str == option.value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="form_str-{{ option.id }}">{{ option.value }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Formation Adjustment -->
                        <div class="mb-3">
                            <label class="form-label">Formation Adjustment</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for option in options.form_adj %}
                                    <input type="radio" class="btn-check" name="form_adj" id="form_adj-{{ option.id }}"
                                           value="{{ option.value }}"
                                           {% if play and play.form_adj == option.value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="form_adj-{{ option.id }}">{{ option.value }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Motion -->
                        <div class="mb-3">
                            <label class="form-label">Motion</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for option in options.motion %}
                                    <input type="radio" class="btn-check" name="motion" id="motion-{{ option.id }}"
                                           value="{{ option.value }}"
                                           {% if play and play.motion == option.value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="motion-{{ option.id }}">{{ option.value }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Protection -->
                        <div class="mb-3">
                            <label class="form-label">Protection</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for option in options.protection %}
                                    <input type="radio" class="btn-check" name="protection"
                                           id="protection-{{ option.id }}" value="{{ option.value }}"
                                           {% if play and play.protection == option.value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="protection-{{ option.id }}">{{ option.value }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Off Play -->
                        <div class="mb-3">
                            <label class="form-label">Off Play</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for option in options.off_play %}
                                    <input type="radio" class="btn-check" name="off_play" id="off_play-{{ option.id }}"
                                           value="{{ option.value }}"
                                           {% if play and play.off_play == option.value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="off_play-{{ option.id }}">{{ option.label }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Directional Call -->
                        <div class="mb-3">
                            <label class="form-label">Directional Call</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for option in options.dir_call %}
                                    <input type="radio" class="btn-check" name="dir_call" id="dir_call-{{ option.id }}"
                                           value="{{ option.value }}"
                                           {% if play and play.dir_call == option.value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="dir_call-{{ option.id }}">{{ option.value }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Tags -->
                        <div class="mb-3">
                            <label class="form-label">Tags</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for option in options.tag %}
                                    <input type="radio" class="btn-check" name="tag" id="tag-{{ option.id }}"
                                           value="{{ option.value }}"
                                           {% if play and play.tag == option.value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="tag-{{ option.id }}">{{ option.value }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Result -->
                        <div class="mb-3">
                            <label class="form-label">Result</label>
                            <div class="btn-group d-flex flex-wrap">
                                {% for result in ['Complete', 'Complete, TD', 'Incomplete', 'Rush', 'Rush, TD', 'Sack', 'Touchdown', 'Interception', 'Interception, Def TD', 'Fumble', 'Fumble, Def TD', 'Punt', 'Penalty'] %}
                                    <input type="radio" class="btn-check" name="result" id="result-{{ result|lower }}"
                                           value="{{ result }}"
                                           {% if play and play.result == result %}checked{% endif %}>
                                    <label class="btn btn-outline-primary"
                                           for="result-{{ result|lower }}">{{ result }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Gain/Loss -->
                        <div class="mb-3">
                            <label class="form-label">Gain/Loss</label>
                            <div class="input-group">
                                <input type="number" class="form-control" name="gain_loss"
                                       min="-99" max="99" required
                                       id="gain_loss" value="{{ play.gain_loss if play else '' }}"
                                       placeholder="Positive for gain, negative for loss">
                                <button type="button" class="btn btn-outline-secondary" onclick="toggleGainLoss()"
                                        title="Toggle between positive and negative">
                                    Toggle +/-
                                </button>
                            </div>
                        </div>
                        <div id="validationWarnings" class="alert alert-danger d-none"></div>

                        <!-- Buttons -->
                        <button type="button" class="btn btn-secondary"
                                onclick="window.location.href='{{ url_for('drive_detail', drive_id=drive.id) }}'">Go
                            Back
                        </button>
                        <button type="submit"
                                class="btn btn-primary">{{ 'Save Changes' if play else 'Add Play' }}</button>

                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/play.js') }}"></script>
{% endblock %}
