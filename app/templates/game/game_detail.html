{% extends "system/base.html" %}
{% block title %}{{ game.game_name }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2>{{ game.name }}</h2>
        <p>{{ game.date.strftime('%d.%m.%Y') }} {{ game.time }}</p>
    </div>
    <div class="col text-end">
        <a href="{{ url_for('drive_chart', game_id=game.id) }}" class="btn btn-primary">Show Drive Chart</a>

        {% if current_user.role == 'admin' %}
        <form action="{{ url_for('delete_game', game_id=game.id) }}" method="POST" class="d-inline">
            <button type="submit" class="btn btn-danger"
                    onclick="return confirm('Are you sure you want to delete this game?')">Delete Game</button>
        </form>
        {% else %}
        <button class="btn btn-secondary" disabled>Delete Game</button>
        {% endif %}
    </div>
</div>

<div class="row mb-4">
    <div class="col">
        <form action="{{ url_for('add_drive', game_id=game.id) }}" method="POST">
            <a href="{{ url_for('game_options') }}" class="btn btn-secondary">Back to Games</a>
            <a href="{{ url_for('export_game', game_id=game.id) }}" class="btn btn-info">Export Game as CSV</a>
            <a href="{{ url_for('dashboard', game_id=game.id) }}" class="btn btn-info">Dashboard</a>
            <button type="submit" class="btn btn-primary">Add Drive</button>
        </form>
    </div>
</div>
			<div class="d-flex mb-3">
				<div class="me-3">
				<label for="Odk" >ODK:</label>
				<select name="Odk" id="Odk" class="form-select mb-2">
					<option value="" selected >All</option>
					<option value="O">Offence</option>
					<option value="D">Defence</option>
					<option value="K">Special Team</option>
				</select>
        </div>
    </div>

<div class="row">
    <div class="col">
        <h3>Drives</h3>
		<div id=drive-wrapper>
			{%include 'game/partials/_drive_rows.html' %}
		</div>
    </div>
</div>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		const odk = document.getElementById('Odk');
		odk.value = "";
		odk.addEventListener('change', (e) => {
			const selectedOdk = e.target.value;
			fetch(`/filter_drives?Odk=${encodeURIComponent(selectedOdk)}&Id={{ game.id }}`)
				   .then(response => response.text())
				   .then(html => {
					   document.getElementById('drive-wrapper').innerHTML = html;
			});
		});
	});
</script>
{% endblock %}
